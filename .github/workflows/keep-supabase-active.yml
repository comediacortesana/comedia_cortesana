# ============================================================================
# GitHub Action: Mantener Supabase Activo
# ============================================================================
# Este workflow hace consultas peri√≥dicas a Supabase para mantenerlo activo
# Ejecuta 2 veces al d√≠a (9:00 y 21:00 UTC)
# ============================================================================

name: Keep Supabase Active

on:
  # Ejecutar seg√∫n schedule (cron)
  schedule:
    # 9:00 UTC (10:00 CET) - Primera consulta del d√≠a
    - cron: '0 9 * * *'
    # 21:00 UTC (22:00 CET) - Segunda consulta del d√≠a
    - cron: '0 21 * * *'
  
  # Tambi√©n permitir ejecuci√≥n manual desde GitHub
  workflow_dispatch:

jobs:
  query-supabase:
    runs-on: ubuntu-latest
    
    steps:
      - name: üì• Checkout repository
        uses: actions/checkout@v4
      
      - name: üêç Setup Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.11'
      
      - name: üì¶ Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install requests python-dotenv
      
      - name: üîç Query Supabase
        env:
          SUPABASE_URL: ${{ secrets.SUPABASE_URL }}
          SUPABASE_KEY: ${{ secrets.SUPABASE_KEY }}
        run: |
          python comedia_cortesana/scripts/keep_supabase_active.py
      
      - name: ‚úÖ Log completion
        run: |
          echo "‚úÖ Consulta completada: $(date)"
          echo "üîÑ Pr√≥xima ejecuci√≥n: seg√∫n schedule (9:00 y 21:00 UTC)"

