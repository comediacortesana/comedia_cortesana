# üìä Gu√≠a: Editar Obras en Google Sheets

## üéØ Dos Formas de Exportar a CSV

### Opci√≥n 1: Desde el HTML (filtrado) ‚≠ê
**Ideal para**: Exportar solo las obras filtradas

1. Abre: `index.html` en tu navegador
2. Aplica filtros (ej: solo Lope de Vega, solo comedias)
3. Click en **"üìä Exportar a CSV"**
4. Se descarga: `teatro_espanol_TIMESTAMP.csv`

**Ventaja**: Solo exportas lo que necesitas editar

### Opci√≥n 2: Desde Django (todas) üöÄ
**Ideal para**: Exportar todas las 2,100 obras

```bash
# Exportar TODAS las obras
python scripts/export_to_csv.py

# Exportar solo 500
python scripts/export_to_csv.py --max 500

# Incluir textos largos del PDF (archivo m√°s grande)
python scripts/export_to_csv.py --con-textos
```

**Archivo generado**: `filtro_basico/obras_completas.csv`

---

## üì• Importar a Google Sheets

### Paso 1: Crear Google Sheet nuevo
1. Ve a https://sheets.google.com
2. Click en **"+ Nuevo"** ‚Üí **"Hoja de c√°lculo en blanco"**
3. N√≥mbrala: **"DELIA - Teatro Espa√±ol - Edici√≥n"**

### Paso 2: Importar el CSV
1. **Archivo** ‚Üí **Importar**
2. **Subir** ‚Üí Arrastra `obras_completas.csv`
3. **Configuraci√≥n de importaci√≥n**:
   - Tipo de separador: **Coma**
   - Detectar autom√°ticamente: ‚úÖ
   - Convertir texto a n√∫meros y fechas: ‚ùå (IMPORTANTE)
4. Click **"Importar datos"**
5. **Ubicaci√≥n**: **Reemplazar hoja de c√°lculo actual**

### Paso 3: Verificar Importaci√≥n
- ‚úÖ Deber√≠a haber 2,101 filas (1 encabezado + 2,100 obras)
- ‚úÖ 32-38 columnas (seg√∫n lo que exportaste)
- ‚úÖ Los acentos se ven correctamente
- ‚úÖ No hay caracteres raros

---

## üìù Editar Colaborativamente

### Compartir con Investigadores:
1. Click **"Compartir"** (arriba derecha)
2. A√±ade emails de investigadores
3. Permisos: **"Editor"** (pueden editar)
4. ‚úÖ Click **"Enviar"**

### Sugerencias de Organizaci√≥n:

#### Congelar Filas y Columnas:
1. Selecciona fila 1 (encabezados)
2. **Ver** ‚Üí **Inmovilizar** ‚Üí **1 fila**
3. (Opcional) Inmovilizar columnas ID y T√≠tulo

#### A√±adir Filtros:
1. Selecciona fila de encabezados
2. **Datos** ‚Üí **Crear un filtro**
3. Ahora puedes filtrar por columna

#### C√≥digo de Colores:
```
Regla de formato condicional:
- Si celda est√° vac√≠a ‚Üí Color amarillo claro
- Si tiene "An√≥nimo" ‚Üí Color naranja
- Si tiene datos ‚Üí Color verde claro
```

#### A√±adir Columna de Estado:
1. A√±ade columna: **"Estado de Revisi√≥n"**
2. Valores posibles:
   - ‚úÖ Completo
   - üîÑ En progreso
   - ‚ö†Ô∏è Necesita revisi√≥n
   - ‚ö™ Pendiente

---

## üîÑ Workflow de Edici√≥n Colaborativa

### Fase 1: Asignaci√≥n
```
Investigador 1: Filas 1-700 (Obras A-G)
Investigador 2: Filas 701-1400 (Obras H-P)
Investigador 3: Filas 1401-2100 (Obras Q-Z)
```

### Fase 2: Priorizaci√≥n
1. Primero completar campos cr√≠ticos:
   - G√©nero, Subg√©nero, Tema
   - Fecha de creaci√≥n
   - Actos y Versos
2. Luego campos secundarios:
   - Manuscritos y ediciones
   - Notas bibliogr√°ficas
3. Finalmente campos especializados:
   - M√∫sica
   - Mecenazgo

### Fase 3: Validaci√≥n
1. Revisar campos completados
2. Verificar contra fuentes
3. Marcar como "‚úÖ Completo"

### Fase 4: Exportar
1. **Archivo** ‚Üí **Descargar** ‚Üí **CSV**
2. Guardar como: `obras_editadas_FECHA.csv`

---

## üì§ Importar de Vuelta a Django

### Script de Importaci√≥n (crear):

```python
# scripts/import_from_csv.py
import csv
from apps.obras.models import Obra
from apps.autores.models import Autor

with open('filtro_basico/obras_editadas_2025-10-30.csv', encoding='utf-8-sig') as f:
    reader = csv.DictReader(f)
    
    for row in reader:
        try:
            obra = Obra.objects.get(id=row['ID'])
            
            # Actualizar campos editados
            if row['G√©nero']:
                obra.genero = row['G√©nero']
            if row['Subg√©nero']:
                obra.subgenero = row['Subg√©nero']
            if row['Tema']:
                obra.tema = row['Tema']
            if row['Fecha de Creaci√≥n']:
                obra.fecha_creacion_estimada = row['Fecha de Creaci√≥n']
            if row['N√∫mero de Actos']:
                obra.actos = int(row['N√∫mero de Actos'])
            if row['N√∫mero de Versos']:
                obra.versos = int(row['N√∫mero de Versos'])
            
            # ... m√°s campos ...
            
            obra.save()
            print(f"‚úÖ Actualizada: {obra.titulo_limpio}")
            
        except Obra.DoesNotExist:
            print(f"‚ö†Ô∏è Obra ID {row['ID']} no encontrada")
        except Exception as e:
            print(f"‚ùå Error en fila {row['ID']}: {e}")
```

### Comando:
```bash
python scripts/import_from_csv.py
```

---

## üí° Tips para Google Sheets

### 1. Validaci√≥n de Datos
A√±ade validaci√≥n a columnas espec√≠ficas:

**Columna "Tipo de Obra":**
- Datos ‚Üí Validaci√≥n de datos
- Criterios: Lista de elementos
- Valores: `comedia,auto,zarzuela,entremes,tragedia,loa,sainete,baile,otro`

**Columna "M√∫sica Conservada":**
- Lista: `S√≠,No`

**Columna "Fuente":**
- Lista: `FUENTESXI,CATCOM,AMBAS`

### 2. F√≥rmulas √ötiles

**Contar campos vac√≠os por fila:**
```
=COUNTBLANK(B2:AJ2)
```

**Porcentaje de completitud:**
```
=(32-COUNTBLANK(B2:AJ2))/32*100
```

**Marcar filas incompletas:**
```
=IF(COUNTBLANK(B2:AJ2)>20,"‚ö†Ô∏è Muy incompleta","‚úÖ Aceptable")
```

### 3. Crear Gr√°ficos
- Gr√°fico de barras: Obras por autor
- Gr√°fico circular: Tipos de obra
- Gr√°fico de l√≠nea: Obras por d√©cada

### 4. Comentarios y Notas
- Click derecho en celda ‚Üí **"Insertar comentario"**
- √ötil para: "Verificar esta fecha", "Fuente dudosa", etc.

---

## üìä Columnas del CSV (32 campos)

| # | Columna | Editable | Notas |
|---|---------|----------|-------|
| 1 | ID | ‚ùå No | Clave √∫nica |
| 2 | T√≠tulo | ‚úÖ S√≠ | Normalizado |
| 3 | T√≠tulo Original | ‚úÖ S√≠ | Como aparece en fuente |
| 4 | T√≠tulos Alternativos | ‚úÖ S√≠ | Separar con ; |
| 5 | Autor | ‚ö†Ô∏è Cuidado | Debe existir en tabla autores |
| 6 | Autor Nombre Completo | ‚úÖ S√≠ | |
| 7 | Autor Nacimiento | ‚úÖ S√≠ | Formato libre |
| 8 | Autor Muerte | ‚úÖ S√≠ | Formato libre |
| 9 | Autor √âpoca | ‚úÖ S√≠ | Ej: Siglo de Oro |
| 10 | Autor Biograf√≠a | ‚úÖ S√≠ | Texto largo OK |
| 11 | Tipo de Obra | ‚úÖ S√≠ | Ver lista validaci√≥n |
| 12 | G√©nero | ‚úÖ S√≠ | Prioritario ‚≠ê |
| 13 | Subg√©nero | ‚úÖ S√≠ | Prioritario ‚≠ê |
| 14 | Tema | ‚úÖ S√≠ | Prioritario ‚≠ê |
| 15 | Fuente Principal | ‚ö†Ô∏è | FUENTESXI, CATCOM, AMBAS |
| 16 | Origen de Datos | ‚ö†Ô∏è | web, pdf, manual |
| 17 | P√°gina PDF | ‚úÖ S√≠ | N√∫mero |
| 18 | N√∫mero de Actos | ‚úÖ S√≠ | Prioritario ‚≠ê |
| 19 | N√∫mero de Versos | ‚úÖ S√≠ | |
| 20 | Idioma | ‚úÖ S√≠ | Default: Espa√±ol |
| 21 | Fecha de Creaci√≥n | ‚úÖ S√≠ | Prioritario ‚≠ê |
| 22 | M√∫sica Conservada | ‚úÖ S√≠ | S√≠/No |
| 23 | Compositor | ‚úÖ S√≠ | |
| 24 | Bibliotecas con M√∫sica | ‚úÖ S√≠ | |
| 25 | Bibliograf√≠a Musical | ‚úÖ S√≠ | |
| 26 | Mecenas | ‚úÖ S√≠ | |
| 27 | Edici√≥n Pr√≠ncipe | ‚úÖ S√≠ | |
| 28 | Notas Bibliogr√°ficas | ‚úÖ S√≠ | |
| 29 | Manuscritos Conocidos | ‚úÖ S√≠ | |
| 30 | Ediciones Conocidas | ‚úÖ S√≠ | |
| 31 | Notas | ‚úÖ S√≠ | |
| 32 | Observaciones | ‚úÖ S√≠ | |

---

## üé® Formato Recomendado en Google Sheets

### Colores por Prioridad:
```
üî¥ Rojo: Campos cr√≠ticos vac√≠os (G√©nero, Tema, Fecha)
üü° Amarillo: Campos importantes vac√≠os (Actos, Versos)
üü¢ Verde: Campos completos
‚ö™ Blanco: Campos opcionales vac√≠os
```

### Ancho de Columnas:
- ID: 50px
- T√≠tulo: 200px
- Autor: 150px
- Campos de texto corto: 120px
- Campos de texto largo (biograf√≠a, notas): 300px

---

## üîÑ Ciclo de Trabajo

```
Django ‚Üí CSV ‚Üí Google Sheets ‚Üí Edici√≥n ‚Üí CSV ‚Üí Django
   ‚Üì                                              ‚Üë
Export                                        Import
```

### Timeline:
1. **D√≠a 1**: Exportar CSV ‚Üí Compartir con investigadores
2. **D√≠as 2-7**: Investigadores completan campos
3. **D√≠a 8**: Descargar CSV editado
4. **D√≠a 8**: Importar de vuelta a Django
5. **D√≠a 8**: Actualizar JSON y GitHub Pages
6. **Repetir** seg√∫n sea necesario

---

## üìã Checklist para Investigadores

**Antes de empezar a editar:**
- [ ] CSV importado correctamente
- [ ] Encabezados congelados
- [ ] Filtros activados
- [ ] Formato condicional aplicado
- [ ] Validaci√≥n de datos configurada

**Durante la edici√≥n:**
- [ ] No eliminar la columna ID
- [ ] No cambiar el orden de columnas
- [ ] Usar validaci√≥n para campos con opciones
- [ ] A√±adir comentarios en celdas dudosas
- [ ] Guardar frecuentemente (auto-guardado de Sheets)

**Al terminar:**
- [ ] Revisar que no haya celdas con #ERROR
- [ ] Verificar acentos y caracteres especiales
- [ ] Descargar como CSV (no como Excel)
- [ ] Enviar o compartir con desarrollador

---

## üö® Errores Comunes y Soluciones

### Error 1: Acentos mal
**Causa**: Encoding incorrecto  
**Soluci√≥n**: El CSV usa UTF-8-BOM, Google Sheets lo detecta autom√°ticamente

### Error 2: Comas en el texto rompen columnas
**Causa**: CSV usa coma como separador  
**Soluci√≥n**: El script escapea autom√°ticamente con comillas

### Error 3: Saltos de l√≠nea rompen filas
**Causa**: Saltos de l√≠nea en notas/observaciones  
**Soluci√≥n**: El script envuelve en comillas los campos largos

### Error 4: Al re-importar fallan algunos IDs
**Causa**: IDs modificados o borrados  
**Soluci√≥n**: ‚ö†Ô∏è NUNCA modificar columna ID

---

## üíæ Comandos √ötiles

### Exportar solo obras incompletas:
```python
# Crear script custom
from apps.obras.models import Obra

# Obras sin g√©nero o tema
obras = Obra.objects.filter(
    Q(genero='') | Q(tema='')
)

# Exportar solo esas
# ... (usar l√≥gica del export_to_csv.py)
```

### Exportar por fuente:
```bash
# Solo CATCOM
python -c "
from apps.obras.models import Obra
obras = Obra.objects.filter(fuente_principal='CATCOM')
# ... exportar
"
```

### Ver progreso de completitud:
```python
# Estad√≠sticas de campos vac√≠os
from apps.obras.models import Obra
from django.db.models import Q

total = Obra.objects.count()
sin_genero = Obra.objects.filter(genero='').count()
sin_tema = Obra.objects.filter(tema='').count()
sin_fecha = Obra.objects.filter(fecha_creacion_estimada='').count()

print(f"Sin g√©nero: {sin_genero}/{total} ({sin_genero/total*100:.1f}%)")
print(f"Sin tema: {sin_tema}/{total} ({sin_tema/total*100:.1f}%)")
print(f"Sin fecha: {sin_fecha}/{total} ({sin_fecha/total*100:.1f}%)")
```

---

## üéØ Campos Prioritarios para Completar

Seg√∫n la investigaci√≥n teatral, estos son los m√°s importantes:

### üî¥ Prioridad ALTA (para clasificaci√≥n):
- G√©nero
- Subg√©nero
- Tema
- Fecha de creaci√≥n
- N√∫mero de actos

### üü° Prioridad MEDIA (para an√°lisis):
- N√∫mero de versos
- Manuscritos conocidos
- Ediciones conocidas
- Edici√≥n pr√≠ncipe

### üü¢ Prioridad BAJA (complementarios):
- Compositor
- Bibliotecas de m√∫sica
- Bibliograf√≠a musical

---

## üì§ Re-importar a Django

### Opci√≥n 1: Script Autom√°tico (crear)

```bash
# Crear script: scripts/import_from_csv.py
python scripts/import_from_csv.py filtro_basico/obras_editadas.csv
```

### Opci√≥n 2: Manualmente en Django Shell

```python
python manage.py shell

import csv
from apps.obras.models import Obra

with open('filtro_basico/obras_editadas.csv', encoding='utf-8-sig') as f:
    reader = csv.DictReader(f)
    actualizadas = 0
    
    for row in reader:
        try:
            obra = Obra.objects.get(id=row['ID'])
            
            # Actualizar solo si hay datos nuevos
            if row['G√©nero'] and not obra.genero:
                obra.genero = row['G√©nero']
            if row['Tema'] and not obra.tema:
                obra.tema = row['Tema']
            if row['Fecha de Creaci√≥n'] and not obra.fecha_creacion_estimada:
                obra.fecha_creacion_estimada = row['Fecha de Creaci√≥n']
            
            obra.save()
            actualizadas += 1
            
            if actualizadas % 100 == 0:
                print(f"‚úÖ {actualizadas} obras actualizadas...")
                
        except Exception as e:
            print(f"‚ùå Error en ID {row['ID']}: {e}")
    
    print(f"\nüéâ Total actualizadas: {actualizadas}")
```

### Opci√≥n 3: Desde Admin de Django
1. Panel admin ‚Üí Obras
2. Importar/Exportar (si tienes django-import-export)
3. Cargar CSV
4. Preview de cambios
5. Confirmar importaci√≥n

---

## üìä Estructura del CSV

### Ejemplo de fila:

```csv
ID,T√≠tulo,Autor,Tipo de Obra,G√©nero,Tema,Actos,Fecha de Creaci√≥n
3058,A Dios por razon de estado,An√≥nimo,comedia,Religiosa,Devoci√≥n,3,1650
```

### Despu√©s de editar en Sheets:

```csv
ID,T√≠tulo,Autor,Tipo de Obra,G√©nero,Tema,Actos,Fecha de Creaci√≥n
3058,A Dios por razon de estado,An√≥nimo,comedia,Religiosa,Devoci√≥n y raz√≥n de estado,3,1650-1660
```

---

## ‚úÖ Ventajas de CSV + Google Sheets

| Ventaja | Descripci√≥n |
|---------|-------------|
| ‚úÖ **Colaborativo** | M√∫ltiples investigadores a la vez |
| ‚úÖ **Historial** | Google guarda todas las versiones |
| ‚úÖ **Comentarios** | Discutir cambios en celdas espec√≠ficas |
| ‚úÖ **Filtros** | Filtrar por tipo, autor, estado |
| ‚úÖ **F√≥rmulas** | C√°lculos autom√°ticos |
| ‚úÖ **Validaci√≥n** | Evita errores de entrada |
| ‚úÖ **Acceso** | Desde cualquier lugar, cualquier dispositivo |
| ‚úÖ **Gratis** | 100% gratuito con cuenta Google |
| ‚úÖ **Familiar** | Todos saben usar Sheets |

---

## üé® Plantilla de Google Sheets (Recomendada)

### Pesta√±as Sugeridas:

1. **üìã Obras Completas** (CSV importado)
2. **üî¥ Pendientes** (filtro: campos vac√≠os)
3. **‚úÖ Completadas** (filtro: todo lleno)
4. **üìä Estad√≠sticas** (gr√°ficos y m√©tricas)
5. **üìù Instrucciones** (gu√≠a para editores)

### Ejemplo de Pesta√±a "Estad√≠sticas":
```
Total de obras: 2,100
Obras completas: 234 (11%)
Obras en progreso: 876 (42%)
Obras pendientes: 990 (47%)

Por investigador:
- Mar√≠a: 234 obras revisadas
- Juan: 187 obras revisadas
- Ana: 156 obras revisadas
```

---

## üîê Permisos Recomendados

### Para Investigadores:
- **Editor**: Pueden editar y comentar

### Para Supervisores:
- **Editor**: Pueden editar y aprobar cambios

### Para Lectura:
- **Lector**: Solo ver (para estudiantes o colaboradores externos)

---

## üìÖ Timeline Sugerido

| Semana | Actividad |
|--------|-----------|
| Semana 1 | Exportar CSV ‚Üí Compartir con equipo |
| Semana 2-4 | Edici√≥n colaborativa (campos prioritarios) |
| Semana 5 | Revisi√≥n y validaci√≥n |
| Semana 6 | Re-importar a Django ‚Üí Actualizar GitHub Pages |
| Semana 7+ | Seguir con campos secundarios |

---

## üéâ Resultado Final

Despu√©s del proceso:
1. ‚úÖ Base de datos Django actualizada
2. ‚úÖ JSON actualizado (`datos_obras.json`)
3. ‚úÖ GitHub Pages con datos completos
4. ‚úÖ Investigadores ven mejoras en tiempo real
5. ‚úÖ Sistema m√°s rico y √∫til

---

## üìû Recursos

- **Google Sheets**: https://sheets.google.com
- **Tutorial validaci√≥n**: https://support.google.com/docs/answer/186103
- **Funciones de Sheets**: https://support.google.com/docs/table/25273
- **Compartir y colaborar**: https://support.google.com/docs/answer/2494822

---

## üí° Pr√≥ximo Nivel

### Integraci√≥n con API de Google Sheets:
```python
# Sincronizaci√≥n bidireccional
# Django ‚Üî Google Sheets en tiempo real
# Usando Google Sheets API

# Los investigadores editan en Sheets
# Django se actualiza autom√°ticamente cada hora
```

Pero empiezas con el CSV simple que ya funciona perfectamente! üé≠


